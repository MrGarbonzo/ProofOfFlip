services:
  agent:
    image: ghcr.io/mrgarbonzo/proofofflip/agent:a958a0531577c8abc229fc0433629b0923d1e55a
    ports:
      - "80:3001"
    environment:
      - AGENT_NAME=${AGENT_NAME:-flipbot}
      - SOLANA_RPC_URL=${SOLANA_RPC_URL}
      - TEE_PROVIDER=secretvm
      - STORAGE_PATH=/secretvm/data
    volumes:
      - agent-data:/secretvm/data
      - ./crypto/docker_public_key_ed25519.pem:/app/data/pubkey.pem:ro
      - ./crypto/docker_attestation_ed25519.txt:/app/data/quote.txt:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    env_file:
      - usr/.env

volumes:
  agent-data:
